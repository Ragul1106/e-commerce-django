{% extends 'base.html' %}
{% block title %}Checkout{% endblock %}

{% block content %}
<h2>Checkout</h2>

{% if items %}
<table class="table">
    <tr>
        <th>Product</th><th>Quantity</th><th>Price</th><th>Total</th>
    </tr>
    {% for item in items %}
    <tr id="checkout-item-{{ item.id }}">
        <td>{{ item.product.name }}</td>
        <td>{{ item.quantity }}</td>
        <td>${{ item.product.price }}</td>
        <td>${{ item.total_price }}</td>
    </tr>
    {% endfor %}
</table>

<h4>Total: $<span id="checkout-total">{{ total }}</span></h4>
<button id="checkout-btn" class="btn btn-primary">Place Order</button>
<span id="checkout-message" class="ms-2"></span>

{% else %}
<p>Your cart is empty.</p>
{% endif %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$('#checkout-btn').click(function(){
    $.ajax({
        url: '/ajax/checkout/',
        type: 'POST',
        data: { csrfmiddlewaretoken: '{{ csrf_token }}' },
        success: function(response){
            if(response.success){
                $('#checkout-message').text(response.message).css('color','green');
                $('table tr[id^="checkout-item-"]').remove();  // Clear cart table
                $('#checkout-total').text('0.00');
                $('#cart-count').text('0');  // Update navbar
            } else {
                $('#checkout-message').text(response.message).css('color','red');
            }
        }
    });
});
</script>
{% endblock %}
